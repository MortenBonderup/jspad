<!DOCTYPE html>
<html lang="da">
    <head>
        <title>JSpad</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
        <link rel="stylesheet" href="minstil.css">
    </head>
    <body onload="enableEditMode();">

        <main class="hovedindhold">
            <section class="rammesektion">
                <div class="rammeindhold">
                    <nav>
                        <!-- <button class="knap" onclick="execCmd(this, 'underline');">&nbsp;<i class="fas fa-save"></i>&nbsp;Gem&nbsp;</button> -->
                        <button class="knap" onclick="fjernFejlmeddelelser();injectJs(erstatWrite(fjernHTMLtags('redigeringsomraade')));">&nbsp;<i class="far fa-play-circle"></i>&nbsp;KÃ¸r JavaScript&nbsp;</button>
                        <!-- <button onclick="execCmd(this, 'copy');"><i class="fas fa-copy"></i>&nbsp;Kopier alt til udklipsholder</button> -->
                    </nav>
                    <div class="rammetekst">
                        JavaScript
                    </div>
                </div>
                <iframe name="richTextField" id="redigeringsomraade" src="about:blank" class="ramme"></iframe>
            </section>
            <section class="rammesektion">
                <div class="rammeindhold">
                    <nav >
                        <button class="knap" onclick="rensJsOutputomraade();"><i class="fas fa-eraser">&nbsp;</i>&nbsp;Slet resultat&nbsp;</button>
                    </nav>
                    <div class="rammetekst">
                        Resultat
                    </div>
                </div>
                <iframe name="outputomraade" id="outputomraade" src="output.html" class="ramme"></iframe>

            </section>
        </main>
        <script>

            function fjernHTMLtags(frameId) {
                var frameObj = document.getElementById(frameId);
                var frameContent = frameObj.contentWindow.document.body.innerHTML;
                return frameContent.replace(/(<([^>]+)>)/ig, "");
            }

            function erstatWrite(js) {
                var pattern = /document.writeln\(/gi;
                var res = js.replace(pattern, "documentwrite.insertAdjacentText('beforeend',");
                pattern = /document.write\(/gi;
                var slutres = res.replace(pattern, "documentwrite.insertAdjacentText('beforeend',");
                return slutres;
            }

            function enableEditMode() {
                richTextField.document.designMode = "On";
            }

            function execCmd(btnElement, command) {
                document.getElementById("redigeringsomraade").focus();
                richTextField.document.execCommand(command, false, null);
            }

            function rensJsOutputomraade() {
                window.frames['outputomraade'].location.replace("output.html");
            }

            function fjernFejlmeddelelser() {
                var iFrameProblem = window.frames["outputomraade"].document.getElementById("problemomraade");
                iFrameProblem.innerHTML = "";

                var iFrameResultat = window.frames["outputomraade"].document.getElementById("documentwrite");
                iFrameResultat.innerHTML = "";
            }

            function injectJs(js) {
                var iFrameBody = window.frames["outputomraade"].document.getElementsByTagName("body")[0];
                var myscript = document.createElement('script');
                myscript.setAttribute("id", "scriptomraade")
                //myscript.async = true;
                scripttxt = 'try {';
                scripttxt += js;
                scripttxt += '} catch(err) { ';
                scripttxt += 'var div = document.getElementById("problemomraade");';
                scripttxt += 'div.innerHTML += "<br>"+err; }';
                //document.write("<br>"+err); }'; /* Problem: Den laver en ny side */
                myscript.innerHTML = scripttxt;
                iFrameBody.appendChild(myscript);
            }

            document.getElementById("redigeringsomraade").contentDocument.body.style.fontFamily = "Lucida Console, Monaco, monospace";
            document.getElementById("outputomraade").contentDocument.body.style.fontFamily = "Lucida Console, Monaco, monospace";
            document.getElementById("redigeringsomraade").focus();

        </script>

    </body>
</html>
